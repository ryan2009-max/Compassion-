import{c as x,u as w,a as j,r as l,j as t,C as N,b,d as S,B as g,e as k,I as v,F as y}from"./index-GGz7ih6m.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=x("CloudUpload",[["path",{d:"M12 13v8",key:"1l5pq0"}],["path",{d:"M4 14.899A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.5 8.242",key:"1pljnt"}],["path",{d:"m8 17 4-4 4 4",key:"1quai1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=x("WifiOff",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=x("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),M="compassion-safe",E=1,d="app-cache",o="sync-queue";function u(){return new Promise((a,s)=>{const e=indexedDB.open(M,E);e.onupgradeneeded=()=>{const n=e.result;n.objectStoreNames.contains(d)||n.createObjectStore(d),n.objectStoreNames.contains(o)||n.createObjectStore(o,{keyPath:"id",autoIncrement:!0})},e.onsuccess=()=>a(e.result),e.onerror=()=>s(e.error)})}async function P(a,s){const e=await u();return new Promise((n,r)=>{const c=e.transaction(d,"readwrite");c.objectStore(d).put(s,a),c.oncomplete=()=>n(),c.onerror=()=>r(c.error)})}async function B(a){const s=await u();return new Promise((e,n)=>{const c=s.transaction(d,"readonly").objectStore(d).get(a);c.onsuccess=()=>e(c.result),c.onerror=()=>n(c.error)})}async function I(a){const s=await u();return new Promise((e,n)=>{const c=s.transaction(o,"readwrite").objectStore(o).add({...a,ts:Date.now()});c.onsuccess=()=>e(c.result),c.onerror=()=>n(c.error)})}async function p(){const a=await u();return new Promise((s,e)=>{const r=a.transaction(o,"readonly").objectStore(o).getAll();r.onsuccess=()=>s(r.result),r.onerror=()=>e(r.error)})}async function A(){const a=await u();return new Promise((s,e)=>{const n=a.transaction(o,"readwrite");n.objectStore(o).clear(),n.oncomplete=()=>s(),n.onerror=()=>e(n.error)})}function T(){const a=w(),{toast:s}=j(),[e,n]=l.useState(""),[r,c]=l.useState(""),[m,h]=l.useState([]);return l.useEffect(()=>{(async()=>{const i=await B("offline-note");c(i??"");const f=await p();h(f)})()},[]),l.useEffect(()=>{a&&(async()=>{if((await p()).length!==0)try{await new Promise(f=>setTimeout(f,300)),await A(),h([]),s({title:"Synced",description:"Offline changes were synchronized."})}catch{s({title:"Sync failed",description:"Will retry when connection is stable.",variant:"destructive"})}})()},[a,s]),t.jsx("div",{className:"min-h-screen p-4 flex items-center justify-center",children:t.jsxs(N,{className:"w-full max-w-xl",children:[t.jsx(b,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx(S,{children:"Offline App Shell"}),t.jsxs(g,{variant:a?"default":"destructive",className:"flex items-center gap-1",children:[a?t.jsx(q,{className:"w-3 h-3"}):t.jsx(O,{className:"w-3 h-3"}),a?"Online":"Offline"]})]})}),t.jsxs(k,{className:"space-y-4",children:[t.jsx("p",{className:"text-sm text-muted-foreground",children:"Core UI loads instantly and remains available without a network connection."}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("label",{className:"text-sm",children:"Write a note (cached offline)"}),t.jsx(v,{value:e,onChange:i=>n(i.target.value),placeholder:"Type and cache"}),t.jsxs("div",{className:"flex gap-2",children:[t.jsx(y,{variant:"default",onClick:async()=>{await P("offline-note",e),c(e),s({title:"Saved locally",description:"Note cached in IndexedDB."})},children:"Cache Note"}),t.jsxs(y,{variant:"outline",onClick:async()=>{await I({type:"note",payload:e});const i=await p();h(i),s({title:"Queued",description:"Change will sync when online."})},children:[t.jsx(C,{className:"w-3 h-3 mr-1"})," Queue Sync"]})]}),t.jsxs("div",{className:"text-xs text-muted-foreground",children:["Cached: ",r||"â€”"]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-sm font-medium",children:"Pending Sync Queue"}),t.jsx("div",{className:"rounded-md border p-2 text-xs max-h-32 overflow-auto",children:m.length===0?"No pending changes":JSON.stringify(m,null,2)})]})]})]})})}export{T as default};
